---
phase: 01-process-monitoring-core
plan: 04
type: execute
wave: 4
depends_on: ["01-01", "01-02", "01-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User can view list of running processes with PID, name, CPU%, memory%, user, runtime"
    - "User can search/filter processes using fuzzy search"
    - "Process data refreshes automatically at configurable intervals"
    - "User can sort processes by clicking column headers"
  artifacts:
    - path: "src/process_monitor.rs"
      provides: "Working process collection"
      exists: true
    - path: "static/processes.html"
      provides: "Process monitoring UI"
      exists: true
    - path: "static/processes.js"
      provides: "Interactive table with search and refresh"
      exists: true
  key_links:
    - from: "static/processes.js"
      to: "/api/processes"
      via: "fetch() retrieves live data"
      pattern: "fetch.*api/processes"
    - from: "ProcessMonitor"
      to: "sysinfo::System"
      via: "Background collection refreshes"
      pattern: "refresh_processes"
---

<objective>
Verify end-to-end process monitoring functionality works as specified in user's vision.

Purpose: Human confirmation that all components integrate correctly and meet user requirements from CONTEXT.md - data collection, API, and UI all working together.
Output: User-verified working process monitor accessible via web interface.
</objective>

<execution_context>
@/home/agentsmith/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/agentsmith/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-process-monitoring-core/01-CONTEXT.md
@.planning/phases/01-process-monitoring-core/01-01-SUMMARY.md
@.planning/phases/01-process-monitoring-core/01-02-SUMMARY.md
@.planning/phases/01-process-monitoring-core/01-03-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete process monitoring system with:
- Backend: ProcessMonitor collecting process data at configurable intervals via sysinfo
- API: /api/processes endpoint serving JSON with PID, name, CPU%, memory%, user, runtime
- Frontend: Web interface with sortable table, fuzzy search, auto-refresh controls
  </what-built>
  
  <how-to-verify>
**1. Start the application:**
```bash
cargo build --release
cargo run --release -- --process-interval 5 web
```

Expected: Application starts without errors, logs show "Started process monitoring with 5s interval"

**2. Access the process monitor:**
- Open browser to http://localhost:3000/processes.html
- Expected: Process table loads showing running processes

**3. Verify data display:**
- Check table shows columns: PID, Name, CPU %, Memory %, User, Runtime
- Expected: Processes sorted by CPU% (highest first) by default
- Verify PID is numeric, Name shows process names, CPU% and Memory% show percentages with decimals
- Verify User shows usernames/UIDs, Runtime shows formatted duration (e.g., "2h 15m")

**4. Test sorting:**
- Click "PID" column header
- Expected: Table re-sorts by PID ascending, click again for descending
- Try sorting by other columns (Name, CPU%, Memory%, User, Runtime)
- Expected: All columns sortable

**5. Test search functionality:**
- Type "bash" in search input
- Expected: Table filters to show only processes matching "bash" (after ~300ms debounce)
- Clear search, type "root"
- Expected: Table filters to processes with "root" user
- Try fuzzy search: type "sys" to match "systemd", "syslog-ng", etc.
- Expected: Fuzzy matching works across all fields
- Type nonsense: "zzzzzz"
- Expected: Empty table with no crashes

**6. Test auto-refresh:**
- Watch "Updated X seconds ago" timestamp
- Expected: Updates every 5 seconds by default
- Change refresh interval to 10 seconds using number input
- Expected: Timestamp updates every 10 seconds
- Uncheck "Auto-refresh" checkbox
- Expected: Updates stop, timestamp freezes
- Check checkbox again
- Expected: Auto-refresh resumes
- Click "Refresh Now" button
- Expected: Immediate refresh, timestamp updates

**7. Test different process intervals:**
- Stop application (Ctrl+C)
- Restart with: `cargo run --release -- --process-interval 10 web`
- Expected: Application starts with 10-second collection interval (check logs)
- Verify UI still works correctly

**8. Test navigation:**
- Click "Back to Logs" link (if logs page exists)
- Expected: Navigates to logs page
- Navigate back to processes page
- Expected: Process monitor still works

**9. Verify resource usage:**
- Run `top` or `htop` in another terminal
- Find the livedata process
- Expected: livedata uses <5% CPU on average (spikes during refresh are normal)
- Expected: Memory usage is reasonable (<100MB for process monitoring)

**10. Check for errors:**
- Open browser console (F12)
- Expected: No JavaScript errors
- Check application logs
- Expected: No error messages, only periodic info logs about process collection
  </how-to-verify>
  
  <resume-signal>
Type "approved" if all verification steps pass and the process monitor works as expected.

If issues found, describe the problem:
- What step failed?
- What was the actual behavior vs expected?
- Any error messages in browser console or application logs?
  </resume-signal>
</task>

</tasks>

<verification>
This plan is entirely human verification - no automated checks.

Success means user has confirmed:
1. Process data collection works
2. API endpoint returns correct JSON
3. Web interface displays processes correctly
4. Search filters processes using fuzzy matching
5. Auto-refresh updates data at configured intervals
6. Sorting works for all columns
7. No errors in browser console or application logs
8. Resource overhead is minimal
</verification>

<success_criteria>
- User confirms all 10 verification steps pass
- Process monitoring matches user's vision from CONTEXT.md:
  - Data table with sortable columns
  - Columns: PID, name, CPU%, memory%, user, runtime
  - Fuzzy search across all columns
  - Auto-refresh with configurable interval
  - Timestamp showing "Updated X seconds ago"
  - Default sort by CPU% descending
- No errors or unexpected behavior observed
- Phase 1 requirements PROCE-01, PROCE-02, PROCE-03 satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/01-process-monitoring-core/01-04-SUMMARY.md`
</output>
