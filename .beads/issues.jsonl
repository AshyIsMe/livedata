{"id":"livedata-187","title":"Epic: Modernize DuckDB Table Schema","description":"Update the DuckDB table schema to use proper data types instead of storing everything as TEXT/JSON. This will improve query performance, enable better parquet compression, and provide type safety.\n\n## Current Issues\n- Timestamp stored as TEXT (RFC3339 strings) instead of proper DATETIME\n- Log fields stored as JSON making queries inefficient  \n- No proper data types for common fields like priority, PID, etc.\n\n## Proposed New Schema\n\n\n## Breaking Changes\n⚠️ This change breaks compatibility with existing data directories as requested.","status":"closed","priority":2,"issue_type":"epic","created_at":"2026-01-18T11:53:13.581728337+10:00","created_by":"aaron","updated_at":"2026-01-18T15:03:00.430665977+10:00","closed_at":"2026-01-18T15:03:00.430665977+10:00","close_reason":"Closed"}
{"id":"livedata-4q7","title":"Update parquet export for new schema","description":"Update `src/parquet_writer.rs` to export the new table schema to parquet files.\n\n### Required Changes\n\n1. **Update COPY SQL**\nModify the COPY command in `write_minute_to_parquet()` to include all new columns:\n\n\n2. **Update Column Order**\nEnsure the export column order matches the new table structure for consistency.\n\n3. **Test Parquet Schema**\nVerify that exported parquet files have the correct column types:\n- timestamp: TIMESTAMP\n- minute_key: TIMESTAMP  \n- message: STRING\n- priority: INT32\n- pid, _uid, _gid: INT32 (nullable)\n- All string fields: STRING\n- extra_fields: JSON\n\n### Files to Modify\n- `src/parquet_writer.rs`\n\n### Dependencies\n- Depends on: livedata-qp3 (DuckDBBuffer schema update)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-18T11:53:22.733364642+10:00","created_by":"aaron","updated_at":"2026-01-18T15:03:00.964609577+10:00","closed_at":"2026-01-18T15:03:00.964609577+10:00","close_reason":"Closed","dependencies":[{"issue_id":"livedata-4q7","depends_on_id":"livedata-187","type":"blocks","created_at":"2026-01-18T11:53:22.734619084+10:00","created_by":"aaron"},{"issue_id":"livedata-4q7","depends_on_id":"livedata-qp3","type":"blocks","created_at":"2026-01-18T11:53:49.262121189+10:00","created_by":"aaron"}]}
{"id":"livedata-mzo","title":"Validation and quality assurance","description":"Comprehensive validation and quality assurance for the schema changes.\n\n### Required Checks\n\n1. **Run Test Suite**\n- Run `cargo test` to ensure all tests pass\n- Run `cargo test --release` for release mode testing\n- Verify no test regressions\n\n2. **Code Quality**\n- Run `cargo clippy` and fix any new lint issues\n- Run `cargo fmt --check` to ensure consistent formatting\n- Fix any compiler warnings\n\n3. **Real Data Testing**\n- Test with real journald data to verify field extraction works correctly\n- Verify common systemd fields are properly extracted\n- Check that uncommon fields are preserved in extra_fields\n\n4. **Parquet Validation**\n- Verify parquet files have proper column types when opened externally\n- Test parquet compression is working with new schema\n- Verify parquet files can be read by external tools (duckdb, pandas, etc.)\n\n5. **Performance Testing**\n- Benchmark common queries on new schema vs old\n- Verify indexing improvements on dedicated columns\n- Test INSERT performance with new schema\n\n6. **Integration Testing**\n- Test the full data pipeline: journald → LogEntry → DuckDB → parquet\n- Verify all existing functionality still works with new schema\n- Test error handling for invalid data\n\n### Success Criteria\n- All tests pass\n- No clippy warnings\n- Real journald data processes correctly\n- Parquet files have correct schema\n- Performance is maintained or improved\n\n### Dependencies\n- Depends on: livedata-qp3 (DuckDBBuffer schema update)\n- Depends on: livedata-4q7 (parquet export update)  \n- Depends on: livedata-vx7 (test updates)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-18T11:53:43.937006131+10:00","created_by":"aaron","updated_at":"2026-01-18T15:03:01.522988826+10:00","closed_at":"2026-01-18T15:03:01.522988826+10:00","close_reason":"Closed","dependencies":[{"issue_id":"livedata-mzo","depends_on_id":"livedata-187","type":"blocks","created_at":"2026-01-18T11:53:43.938437084+10:00","created_by":"aaron"},{"issue_id":"livedata-mzo","depends_on_id":"livedata-qp3","type":"blocks","created_at":"2026-01-18T11:53:56.366694307+10:00","created_by":"aaron"},{"issue_id":"livedata-mzo","depends_on_id":"livedata-4q7","type":"blocks","created_at":"2026-01-18T11:53:59.115359276+10:00","created_by":"aaron"},{"issue_id":"livedata-mzo","depends_on_id":"livedata-vx7","type":"blocks","created_at":"2026-01-18T11:54:11.417420756+10:00","created_by":"aaron"}]}
{"id":"livedata-qp3","title":"Update DuckDBBuffer schema and field extraction logic","description":"Update `src/duckdb_buffer.rs` to implement the new table schema and field extraction logic.\n\n### Required Changes\n\n1. **Update Table Schema**\nReplace current schema with new TIMESTAMP columns and dedicated field columns.\n\n2. **Update add_entry() Method**\n- Extract common fields from `entry.fields` HashMap into dedicated columns\n- Implement type conversions (priority/pid/uid/gid to INTEGER)\n- Move unrecognized fields to `extra_fields` JSON column\n- Handle nullable fields correctly\n\n3. **Update Indexes**\nAdd new indexes for priority, hostname, systemd_unit columns.\n\n4. **Update Query Methods**\n- Update all methods to handle new column structure\n- Ensure proper handling of NULL values for nullable columns\n\n### Field Mappings\n- MESSAGE → message (TEXT)\n- PRIORITY → priority (INTEGER, 0-7)\n- _SYSTEMD_UNIT → systemd_unit (TEXT)\n- _HOSTNAME → hostname (TEXT)\n- _PID → pid (INTEGER, nullable)\n- _EXE → exe (TEXT)\n- SYSLOG_IDENTIFIER → syslog_identifier (TEXT)\n- SYSLOG_FACILITY → syslog_facility (TEXT)\n- _UID → _uid (INTEGER, nullable)\n- _GID → _gid (INTEGER, nullable)\n- _COMM → _comm (TEXT)\n- All other fields → extra_fields (JSON)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-18T11:53:18.320796385+10:00","created_by":"aaron","updated_at":"2026-01-18T15:03:00.778021452+10:00","closed_at":"2026-01-18T15:03:00.778021452+10:00","close_reason":"Closed","dependencies":[{"issue_id":"livedata-qp3","depends_on_id":"livedata-187","type":"blocks","created_at":"2026-01-18T11:53:18.329171134+10:00","created_by":"aaron"}]}
{"id":"livedata-vx7","title":"Update tests for new schema","description":"Update and add tests to handle the new DuckDB table schema.\n\n### Required Changes\n\n1. **Fix Existing Tests in duckdb_buffer.rs**\n- Update tests that expect old schema (timestamp TEXT, fields JSON)\n- Fix `test_add_and_retrieve_entry()` to handle new column structure\n- Update `test_buffer_stats()` and `test_delete_minute()` for new schema\n- Update all INSERT/SELECT statements in tests\n\n2. **Fix Existing Tests in parquet_writer.rs**\n- Update `test_parquet_writer_creation()` if needed\n- Update any tests that validate parquet export structure\n- Ensure tests work with new column types\n\n3. **Add New Tests**\n- Test type conversions (string to INTEGER for priority, pid, etc.)\n- Test field extraction logic from HashMap to dedicated columns\n- Test nullable field handling (NULL values for missing fields)\n- Test extra_fields JSON preservation for uncommon fields\n- Test timestamp handling as TIMESTAMP instead of TEXT\n\n4. **Test Edge Cases**\n- Invalid integer values in fields (should become NULL)\n- Missing common fields (should be NULL)\n- Empty extra_fields (no uncommon fields present)\n- Very long text fields in string columns\n\n### Files to Modify\n- `src/duckdb_buffer.rs` (test section)\n- `src/parquet_writer.rs` (test section)\n\n### Dependencies\n- Depends on: livedata-qp3 (DuckDBBuffer schema update)\n- Depends on: livedata-4q7 (parquet export update)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-18T11:53:35.032670153+10:00","created_by":"aaron","updated_at":"2026-01-18T15:03:01.271265408+10:00","closed_at":"2026-01-18T15:03:01.271265408+10:00","close_reason":"Closed","dependencies":[{"issue_id":"livedata-vx7","depends_on_id":"livedata-187","type":"blocks","created_at":"2026-01-18T11:53:35.034143796+10:00","created_by":"aaron"},{"issue_id":"livedata-vx7","depends_on_id":"livedata-qp3","type":"blocks","created_at":"2026-01-18T11:53:51.717652018+10:00","created_by":"aaron"},{"issue_id":"livedata-vx7","depends_on_id":"livedata-4q7","type":"blocks","created_at":"2026-01-18T11:53:54.118778247+10:00","created_by":"aaron"}]}
