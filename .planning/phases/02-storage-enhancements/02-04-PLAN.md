---
phase: 02-storage-enhancements
plan: 04
type: execute
wave: 3
depends_on: ["02-02", "02-03"]
files_modified: [src/web_server.rs, static/index.html, static/processes.html, static/processes.js]
autonomous: true
must_haves:
  truths:
    - "User can switch between Logs and Processes via header links"
    - "Storage health indicator is visible in the UI"
    - "Navigation links open in new tabs as per decision"
  artifacts:
    - path: "static/index.html"
      provides: "Global navigation"
    - path: "static/processes.html"
      provides: "Storage health display"
---

<objective>
Improve user experience with a shared navigation header and visibility into storage health.
</objective>

<execution_context>
@/home/agentsmith/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-storage-enhancements/02-02-SUMMARY.md
@.planning/phases/02-storage-enhancements/02-03-SUMMARY.md
@src/web_server.rs
@static/index.html
@static/processes.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Global Navigation Header</name>
  <files>src/web_server.rs, static/index.html, static/processes.html</files>
  <action>
    - Add a `<header>` section with a `<nav>` containing:
        - Link to "Log Search" (`/`)
        - Link to "Processes" (`/processes.html`)
    - Ensure links use `target="_blank"` to preserve context as per decision.
    - Update the `build_search_html` function in `web_server.rs` to include this header.
    - Apply consistent styling to the header across all pages.
  </action>
  <verify>
    - Open the browser and verify the header is present and links work as expected (opening new tabs).
  </verify>
  <done>
    - Navigation between core features is effortless.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement Storage Health Indicator</name>
  <files>src/web_server.rs, static/processes.js, static/processes.html</files>
  <action>
    - Add a placeholder in `static/processes.html` and the log search page for storage health.
    - Fetch data from `/api/storage/health` and display it:
        - Example: "Retention: 30d logs / 7d proc | DB Size: 1.2GB / 1.5GB"
    - Use color coding (green/yellow/red) based on how close the database is to its size limits.
  </action>
  <verify>
    - Storage health stats appear in the UI and match actual disk/config values.
  </verify>
  <done>
    - Users have immediate visibility into the application's storage state.
  </done>
</task>

</tasks>

<verification>
- Visual verification of UI changes.
- Navigation links work correctly.
- Storage stats update on refresh.
</verification>

<success_criteria>
- Seamless navigation between Logs and Processes.
- Transparent storage management visibility in the UI.
</success_criteria>

<output>
After completion, create `.planning/phases/02-storage-enhancements/02-04-SUMMARY.md`
</output>
